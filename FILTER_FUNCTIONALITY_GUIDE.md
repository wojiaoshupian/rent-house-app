# 🔍 筛选功能使用指南

## 🎯 功能概述

为房间管理和抄水电表功能添加了完整的筛选功能，用户可以按楼宇和房间来筛选查看相关数据，提高数据查找和管理效率。

## ✅ 已实现的筛选功能

### 1. 房间管理筛选
- **🏢 楼宇筛选**：按楼宇筛选房间列表
- **📊 实时更新**：选择楼宇后自动更新房间列表
- **🔄 状态保持**：筛选状态在页面间保持

### 2. 抄表记录筛选
- **🏢 楼宇筛选**：按楼宇筛选抄表记录
- **🏠 房间筛选**：按具体房间筛选抄表记录
- **🔗 联动筛选**：楼宇和房间筛选联动
- **📈 统计更新**：筛选后实时更新记录统计

### 3. 创建抄表记录筛选
- **🏢 楼宇筛选**：按楼宇筛选可选房间
- **🏠 房间范围**：只显示选中楼宇下的房间
- **📊 实时统计**：显示当前可选房间数量
- **🔄 智能清理**：切换楼宇时自动清除房间选择

### 4. 智能筛选逻辑
- **层级筛选**：楼宇 → 房间的层级筛选
- **自动清理**：选择楼宇时自动清除房间筛选
- **状态同步**：筛选状态与数据同步更新

## 🚀 筛选器界面

### 1. 房间列表筛选器

**位置**：房间列表页面 Header 下方

**功能**：
- **🏢 楼宇筛选下拉框**
  - 显示当前选中楼宇
  - 点击展开/收起楼宇列表
  - 支持选择"全部楼宇"或具体楼宇

**操作流程**：
```
点击"筛选楼宇" → 展开楼宇列表 → 选择楼宇 → 自动筛选房间
```

### 2. 抄表记录筛选器

**位置**：抄表记录列表页面 Header 下方

**功能**：
- **🏢 楼宇筛选下拉框**
  - 显示当前选中楼宇
  - 点击展开/收起楼宇列表
  - 支持选择"全部楼宇"或具体楼宇

- **🏠 房间筛选下拉框**
  - 显示当前选中房间
  - 点击展开/收起房间列表
  - 支持选择"全部房间"或具体房间
  - 房间列表根据楼宇筛选动态更新

**操作流程**：
```
方式1：楼宇筛选
点击"筛选楼宇" → 选择楼宇 → 查看该楼宇下所有抄表记录

方式2：房间筛选
点击"筛选房间" → 选择房间 → 查看该房间的抄表记录

方式3：组合筛选
选择楼宇 → 在该楼宇下选择房间 → 查看特定房间记录
```

### 3. 创建抄表记录筛选器

**位置**：创建抄表记录页面 Header 下方

**功能**：
- **🏢 楼宇筛选下拉框**
  - 显示当前选中楼宇
  - 点击展开/收起楼宇列表
  - 支持选择"全部楼宇"或具体楼宇
  - 筛选后只显示该楼宇下的房间

**操作流程**：
```
进入创建抄表页面 → 选择楼宇 → 在该楼宇下选择房间 → 填写抄表数据
```

**智能功能**：
- **房间范围限制**：选择楼宇后，房间选择器只显示该楼宇下的房间
- **自动清理**：切换楼宇时，如果当前选中的房间不在新楼宇下，自动清除房间选择
- **统计显示**：Header显示当前楼宇下可选房间数量

## 🎮 筛选器操作详解

### 1. 楼宇筛选操作

#### 展开楼宇筛选器
- **触发**：点击"🏢 筛选楼宇"行
- **显示**：当前选中楼宇名称
- **状态**：展开时显示"▲"，收起时显示"▼"

#### 楼宇选择
- **全部楼宇**：显示所有数据，清除楼宇筛选
- **具体楼宇**：只显示该楼宇相关数据
- **视觉反馈**：选中项高亮显示（蓝色背景）

#### 选择效果
- **房间列表**：只显示选中楼宇下的房间
- **抄表记录**：只显示选中楼宇下的抄表记录
- **统计更新**：页面标题显示筛选后的数据量

### 2. 房间筛选操作（仅抄表记录）

#### 展开房间筛选器
- **触发**：点击"🏠 筛选房间"行
- **显示**：当前选中房间名称
- **动态更新**：房间列表根据楼宇筛选更新

#### 房间选择
- **全部房间**：显示当前楼宇下所有房间的记录
- **具体房间**：只显示该房间的抄表记录
- **智能筛选**：如果已选楼宇，只显示该楼宇下的房间

#### 联动逻辑
- **选择楼宇**：自动清除房间筛选，更新房间列表
- **选择房间**：保持楼宇筛选，精确到具体房间
- **清除楼宇**：房间列表恢复为全部房间

## 📊 筛选状态显示

### 1. Header 信息更新

#### 房间列表页面
```
房间管理
全部楼宇 - 共 X 个房间          // 无筛选
楼宇名称 - 共 X 个房间          // 楼宇筛选
```

#### 抄表记录页面
```
抄表记录
全部记录 - 共 X 条记录          // 无筛选
楼宇名称 - 共 X 条记录          // 楼宇筛选
房间 XXX - 共 X 条记录          // 房间筛选
```

### 2. 筛选器状态显示

#### 楼宇筛选器
```
🏢 筛选楼宇  全部楼宇           // 无筛选
🏢 筛选楼宇  楼宇名称           // 已筛选
```

#### 房间筛选器
```
🏠 筛选房间  全部房间           // 无筛选
🏠 筛选房间  房间 101           // 已筛选
```

## 🔧 技术实现

### 1. 筛选参数传递

#### 房间列表筛选
```typescript
// 获取房间列表时传递楼宇ID
const params = selectedBuildingId ? { buildingId: selectedBuildingId } : undefined;
roomService.getRoomList(params).subscribe(...)
```

#### 抄表记录筛选
```typescript
// 构建筛选参数
const params: any = {};
if (selectedRoomId) {
  params.roomId = selectedRoomId;
} else if (selectedBuildingId) {
  params.buildingId = selectedBuildingId;
}
utilityReadingService.getUtilityReadingList(params).subscribe(...)
```

### 2. 状态管理

#### 筛选状态
```typescript
const [selectedBuildingId, setSelectedBuildingId] = useState<number | undefined>();
const [selectedRoomId, setSelectedRoomId] = useState<number | undefined>();
const [showBuildingFilter, setShowBuildingFilter] = useState(false);
const [showRoomFilter, setShowRoomFilter] = useState(false);
```

#### 联动逻辑
```typescript
// 选择楼宇时清除房间筛选
const handleBuildingSelect = (buildingId?: number) => {
  setSelectedBuildingId(buildingId);
  setSelectedRoomId(undefined); // 清除房间筛选
  fetchRooms(); // 更新房间列表
};
```

### 3. 数据更新

#### 自动刷新
```typescript
// 筛选条件变化时自动获取数据
useEffect(() => {
  fetchRooms();
  fetchReadings();
}, [selectedBuildingId, selectedRoomId]);
```

## 🎨 界面设计

### 1. 筛选器样式

#### 容器样式
- **背景色**：白色
- **边框**：底部浅灰色边框
- **内边距**：20px 水平，12px 垂直

#### 筛选项样式
- **未选中**：灰色文字，透明背景
- **已选中**：蓝色文字，浅蓝色背景
- **悬停效果**：轻微背景色变化

#### 展开/收起指示
- **展开**：▲ 符号
- **收起**：▼ 符号
- **颜色**：灰色

### 2. 下拉列表样式

#### 容器
- **边框**：浅灰色边框
- **圆角**：8px
- **背景**：浅灰色背景
- **最大高度**：200px，超出滚动

#### 选项
- **内边距**：12px
- **分隔线**：浅灰色底边框
- **选中状态**：蓝色背景和文字

## 💡 使用场景

### 1. 房东管理多个楼宇
```
场景：房东有多个楼宇，想查看特定楼宇的房间
操作：选择楼宇 → 查看该楼宇下的所有房间
```

### 2. 查看特定房间的抄表记录
```
场景：需要查看某个房间的历史抄表记录
操作：选择楼宇 → 选择房间 → 查看该房间的抄表历史
```

### 3. 楼宇维护管理
```
场景：对某个楼宇进行维护，需要查看相关数据
操作：选择楼宇 → 查看该楼宇的房间和抄表情况
```

### 4. 数据统计分析
```
场景：分析不同楼宇的经营情况
操作：逐个选择楼宇 → 对比各楼宇的数据
```

## 🚨 注意事项

### 1. 筛选逻辑
- **优先级**：房间筛选 > 楼宇筛选 > 无筛选
- **清除规则**：选择楼宇时自动清除房间筛选
- **数据一致性**：筛选条件与显示数据保持一致

### 2. 性能考虑
- **按需加载**：只在需要时获取筛选数据
- **缓存策略**：楼宇和房间列表适当缓存
- **防抖处理**：避免频繁的筛选操作

### 3. 用户体验
- **状态反馈**：清晰显示当前筛选状态
- **操作便捷**：一键清除筛选条件
- **视觉一致**：筛选器样式与整体设计一致

## 🔍 测试验证

### 1. 功能测试
```
1. 测试楼宇筛选是否正常工作
2. 测试房间筛选是否正常工作
3. 测试筛选联动逻辑是否正确
4. 测试筛选状态显示是否准确
5. 测试清除筛选是否正常
```

### 2. 界面测试
```
1. 测试筛选器展开/收起动画
2. 测试选中状态的视觉反馈
3. 测试长列表的滚动效果
4. 测试不同屏幕尺寸的适配
```

### 3. 数据测试
```
1. 测试空数据时的筛选器显示
2. 测试大量数据时的筛选性能
3. 测试筛选结果的准确性
4. 测试筛选状态的持久化
```

## 🎉 功能特点

### 1. 智能化
- **联动筛选**：楼宇和房间智能联动
- **自动清理**：避免无效的筛选组合
- **状态同步**：筛选状态与数据实时同步

### 2. 易用性
- **直观操作**：点击即可展开筛选选项
- **清晰反馈**：当前筛选状态一目了然
- **快速切换**：一键切换不同筛选条件

### 3. 灵活性
- **多级筛选**：支持楼宇和房间两级筛选
- **组合筛选**：支持多种筛选条件组合
- **可扩展性**：易于添加更多筛选条件

现在房间管理和抄水电表功能都具备了完整的筛选功能，用户可以方便地按楼宇和房间来筛选查看相关数据，大大提高了数据管理的效率！
